# 基礎設施管理系統架構

## 目錄結構

```
infrastructure/
├── src/                     # 主要源碼目錄
│   ├── main.go              # 程式入口點
│   ├── go.mod               # Go 模組定義
│   ├── internal/            # 內部模組
│   │   ├── models/          # 數據模型定義
│   │   │   └── models.go    # 所有資料庫表格模型
│   │   ├── proxy/           # 代理功能
│   │   │   ├── proxy.go     # 代理邏輯實現
│   │   │   └── routes.go    # 代理路由配置
│   │   └── admin/           # 管理功能
│   │       ├── handlers.go  # 管理介面處理器
│   │       └── routes.go    # 管理介面路由
│   ├── templates/           # HTML 模板
│   │   ├── layout.html      # 主要佈局模板
│   │   ├── login.html       # 登入頁面
│   │   ├── dashboard.html   # 儀表板頁面
│   │   ├── persons.html     # 人員列表頁面
│   │   ├── person_form.html # 人員編輯頁面
│   │   ├── services.html    # 服務列表頁面
│   │   ├── service_form.html# 服務編輯頁面
│   │   ├── tokens.html      # 令牌列表頁面
│   │   ├── token_form.html  # 令牌編輯頁面
│   │   ├── permissions.html # 權限列表頁面
│   │   ├── permission_form.html # 權限編輯頁面
│   │   └── error.html       # 錯誤頁面
│   └── static/              # 靜態資源
├── Dockerfile               # Docker 映像檔建構設定
├── docker-compose.yml       # Docker Compose 設定
├── README.md                # 專案說明文檔
└── 專案架構.md               # 本文件
```

## 數據模型

### Person 人員

表示使用系統的人員。

- ID
- Name：姓名
- Email：電子郵件（唯一）
- IsActive：是否啟用
- CreatedAt/UpdatedAt/DeletedAt：時間戳記

### Service 服務

表示可以通過代理訪問的服務。

- ID
- Name：服務名稱（唯一）
- URL：服務的URL地址
- Description：服務描述
- IsActive：是否啟用
- CreatedAt/UpdatedAt/DeletedAt：時間戳記

### Token 令牌

表示用於訪問服務的認證令牌。

- ID
- TokenValue：令牌值（唯一）
- ExpireAt：過期時間
- IsActive：是否啟用
- PersonID：關聯的人員ID
- ServiceID：關聯的服務ID
- CreatedAt/UpdatedAt/DeletedAt：時間戳記

### Permission 權限

表示人員對服務的訪問權限。

- ID
- PersonID：關聯的人員ID
- ServiceID：關聯的服務ID
- CreatedAt/UpdatedAt/DeletedAt：時間戳記

### UsageStat 使用統計

記錄服務使用情況。

- ID
- PersonID：關聯的人員ID
- ServiceID：關聯的服務ID
- TokenID：關聯的令牌ID
- RequestPath：請求路徑
- RequestMethod：請求方法
- ResponseCode：響應狀態碼
- RequestTime：請求時間
- Duration：處理時間（毫秒）
- CreatedAt/UpdatedAt：時間戳記

### Admin 管理員

管理系統的管理員帳號。

- ID
- Username：用戶名（唯一）
- PasswordHash：密碼雜湊
- CreatedAt/UpdatedAt/DeletedAt：時間戳記

## API 路徑

### 代理 API

- `/{service_name}/{token_value}/{target_path}` - 將請求代理到目標服務

### 管理介面 API

- `/admin/login` - 登入頁面
- `/admin/logout` - 登出
- `/admin/dashboard` - 儀表板
- `/admin/persons` - 人員列表
- `/admin/persons/create` - 新增人員
- `/admin/persons/update/:id` - 編輯人員
- `/admin/persons/delete/:id` - 刪除人員
- `/admin/services` - 服務列表
- `/admin/services/create` - 新增服務
- `/admin/services/update/:id` - 編輯服務
- `/admin/services/delete/:id` - 刪除服務
- `/admin/tokens` - 令牌列表
- `/admin/tokens/create` - 新增令牌
- `/admin/tokens/update/:id` - 編輯令牌
- `/admin/tokens/delete/:id` - 刪除令牌
- `/admin/permissions` - 權限列表
- `/admin/permissions/create` - 新增權限
- `/admin/permissions/delete/:id` - 刪除權限