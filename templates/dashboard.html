<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .title }}</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
</head>

<body>
    <nav class="navbar">
        <a href="/dashboard" class="navbar-brand">基礎設施管理系統</a>
        <ul class="navbar-nav">
            <li class="nav-item"><a href="/dashboard" class="nav-link">儀表板</a></li>
            <li class="nav-item"><a href="/users" class="nav-link">使用者</a></li>
            <li class="nav-item"><a href="/services" class="nav-link">服務</a></li>
            <li class="nav-item"><a href="/tokens" class="nav-link">Token</a></li>
            <li class="nav-item"><a href="/change-password" class="nav-link">修改密碼</a></li>
            <li class="nav-item"><a href="javascript:logout()" class="nav-link">登出</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- 統計卡片區塊 -->
        <div class="stats-overview">
            <h2><i class="fas fa-chart-line"></i> 關鍵指標</h2>
            <div class="dashboard-grid">
                <div class="stat-card compact">
                    <div class="stat-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-title">API 請求（30 天總計）</div>
                        <div class="stat-value" id="totalRequests">0</div>
                        <div class="stat-trend" id="totalRequestsTrend"></div>
                    </div>
                </div>
                <div class="stat-card compact">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-title">啟用使用者</div>
                        <div class="stat-value" id="activeUsers">0</div>
                        <div class="stat-trend" id="activeUsersTrend"></div>
                    </div>
                </div>
                <div class="stat-card compact">
                    <div class="stat-icon">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-title">啟用服務</div>
                        <div class="stat-value" id="activeServices">0</div>
                        <div class="stat-trend" id="activeServicesTrend"></div>
                    </div>
                </div>
                <div class="stat-card compact">
                    <div class="stat-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-title">啟用 Token</div>
                        <div class="stat-value" id="activeTokens">0</div>
                        <div class="stat-trend" id="activeTokensTrend"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 圖表區塊（重新排序：趨勢優先 -> 分析） -->
        <div class="charts-section">
            <!-- 主要趨勢圖表（全寬） -->
            <div class="chart-card primary">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-chart-area"></i> 每日請求數量趨勢</h2>
                    <div class="time-selector">
                        <select id="dailyRequestsTimeRange" onchange="updateDailyRequestsChart()">
                            <option value="7">過去 7 天</option>
                            <option value="30" selected>過去 30 天</option>
                            <option value="90">過去 90 天</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="dailyRequestsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 時間趨勢（並排顯示：服務、Token） -->
            <div class="trends-section">
                <div class="trend-card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-history"></i> 服務使用量趨勢</h2>
                        <div class="filter-container">
                            <select id="serviceTimeSelector" onchange="updateServiceTimeChart()">
                                <option value="all" selected>全部服務</option>
                            </select>
                            <select id="serviceTimeRange" onchange="updateServiceTimeChart()">
                                <option value="7">過去 7 天</option>
                                <option value="30" selected>過去 30 天</option>
                                <option value="90">過去 90 天</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="serviceTimeChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="trend-card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-clock"></i> Token 使用量趨勢</h2>
                        <div class="filter-container">
                            <select id="tokenTimeSelector" onchange="updateTokenTimeChart()">
                                <option value="all" selected>全部 Token</option>
                            </select>
                            <select id="tokenTimeRange" onchange="updateTokenTimeChart()">
                                <option value="7">過去 7 天</option>
                                <option value="30" selected>過去 30 天</option>
                                <option value="90">過去 90 天</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="tokenTimeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 分析類圖表（並排與全寬混合） -->
            <div class="charts-grid">
                <div class="chart-card secondary">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-pie-chart"></i> 服務使用量統計</h2>
                        <div class="chart-type-selector">
                            <button class="btn btn-sm chart-type-btn active"
                                onclick="switchChartType('serviceUsage', 'bar')">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                            <button class="btn btn-sm chart-type-btn" onclick="switchChartType('serviceUsage', 'pie')">
                                <i class="fas fa-chart-pie"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="serviceUsageChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="chart-card analysis">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-users-cog"></i> 使用者服務使用量</h2>
                        <div class="filter-container">
                            <select id="userServiceSelector" onchange="updateUserServiceChart()">
                                <option value="all" selected>全部使用者</option>
                            </select>
                            <div class="chart-type-selector">
                                <button class="btn btn-sm chart-type-btn active"
                                    onclick="switchChartType('userService', 'bar')"><i
                                        class="fas fa-chart-bar"></i></button>
                                <button class="btn btn-sm chart-type-btn"
                                    onclick="switchChartType('userService', 'pie')"><i
                                        class="fas fa-chart-pie"></i></button>
                                <button class="btn btn-sm chart-type-btn"
                                    onclick="switchChartType('userService', 'line')"><i
                                        class="fas fa-chart-line"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="userServiceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 使用者 Token（全寬） -->
            <div class="chart-card primary">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-key"></i> 使用者 Token 使用量</h2>
                    <div class="filter-container">
                        <select id="userTokenSelector" onchange="updateUserTokenChart()">
                            <option value="all" selected>全部使用者</option>
                        </select>
                        <div class="chart-type-selector">
                            <button class="btn btn-sm chart-type-btn active"
                                onclick="switchChartType('userToken', 'bar')"><i class="fas fa-chart-bar"></i></button>
                            <button class="btn btn-sm chart-type-btn" onclick="switchChartType('userToken', 'pie')"><i
                                    class="fas fa-chart-pie"></i></button>
                            <button class="btn btn-sm chart-type-btn" onclick="switchChartType('userToken', 'line')"><i
                                    class="fas fa-chart-line"></i></button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="userTokenChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
</body>

</html>